function init(){IsPC()?(IsPC(),friendShowHide(),document.getElementById("get-code").addEventListener("click",queryPhone)):window.location.href=appLink+window.location.href.slice(window.location.href.indexOf("sn=")+3)}function IsPC(){for(var e=navigator.userAgent,n=new Array("Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"),t=!0,o=0;o<n.length;o++)if(e.indexOf(n[o])>0){t=!1;break}return t}function phoneValidate(){return/^1[3456789]\d{9}$/.test(document.getElementById("phone").value)?(IsPC()&&(document.getElementById("phone-error").innerHTML=""),!0):IsPC()?(document.getElementById("phone-error").innerHTML="*请输入正确的手机号码",!1):(errorToast("*请输入正确的手机号码"),!1)}function codeValidate(){return/^[0-9]{6}$/.test(document.getElementById("code").value)?(IsPC()&&(document.getElementById("code-error").innerHTML=""),!0):IsPC()?(document.getElementById("code-error").innerHTML="*请输入正确的验证码",!1):(errorToast("*请输入正确的验证码"),!1)}function passwordValidate(){var e=document.getElementById("password").value;return new RegExp(/^[0-9A-Za-z]+$/).test(e)&&new RegExp(/[A-Za-z].*[0-9]|[0-9].*[A-Za-z]/).test(e)?(IsPC()&&(document.getElementById("password-error").innerHTML=""),!0):(IsPC()?document.getElementById("password-error").innerHTML="*请输入8至20位数字和字母组合":errorToast("*请输入8至20位数字和字母组合"),!1)}function errorToast(e){var n='<div class="error-toast" id="error-toast"><span>'+e+"</span></div>";document.getElementById("error-toast")?(document.body.removeChild(document.getElementById("error-toast")),document.body.insertAdjacentHTML("afterBegin",n)):(document.body.insertAdjacentHTML("afterBegin",n),setTimeout(function(){document.body.removeChild(document.getElementById("error-toast"))},1e3))}function setPhoneCode(e){switch(e.value=e.value.replace(/[^\d]/g,""),e.id){case"phone":e.value.length>11&&(e.value=e.value.slice(0,11)),clearHideShowImg(e);break;case"code":e.value.length>6&&(e.value=e.value.slice(0,6))}}function clearHideShowImg(e){switch(e.id){case"phone":""!=e.value?document.getElementById("clear-phone").style.display="block":document.getElementById("clear-phone").style.display="none";break;case"password":""!=e.value?(document.getElementById("clear-password").style.display="block",document.getElementById("hide-show").style.display="block"):(document.getElementById("clear-password").style.display="none",document.getElementById("hide-show").style.display="none")}}function clearInputValue(e){switch(e.id){case"clear-phone":document.getElementById("phone").value="",clearHideShowImg(document.getElementById("phone"));break;case"clear-password":document.getElementById("password").value="",clearHideShowImg(document.getElementById("password"))}}function passwordToggleHideShow(e){var n=document.getElementById("password");switch(n.type){case"password":n.type="text",e.src="assets/show.png";break;case"text":n.type="password",e.src="assets/hide.png"}}function queryPhone(){var e=document.getElementById("phone"),n=document.getElementById("phone-error");/^1[3456789]\d{9}$/.test(e.value)?ajaxSubmit({type:"GET",url:"isPhoneUsed",data:{phoneReg:document.getElementById("phone").value,invitePhone:"null"},success:function(e){return"A0001"===e.rcd?IsPC()?(n.innerHTML=e.rmg,!1):(errorToast(e.rmg),!1):"A0002"===e.rcd?(IsPC()&&(n.innerHTML=""),alertPicCode(),!0):IsPC()?(n.innerHTML=e.rmg,!1):(errorToast(e.rmg),!1)}}):phoneValidate()}function sendCode(e){function n(e){var n=e<10?"0"+e:e;e>0?o.innerHTML=n+"s":(clearInterval(t),o.innerHTML="重新获取")}var t,o=document.getElementById("get-code"),r=document.getElementById("code-error"),d=60;ajaxSubmit({type:"POST",url:"sendPCode",data:{phoneReg:e.value,imgKey:imgKey,imgCode:$(".input-pic-code").val(),source:"pc"},success:function(e){"R0001"===e.rcd?IsPC()?(r.innerHTML=e.rmg,n(d),t=setInterval(function(){d--,n(d)},1e3),$(".alert-pic-code").hide()):errorToast(e.rmg):IsPC()?$(".pic-code-error").html(e.rmg):errorToast(e.rmg)}})}function formSubmit(){if(phoneValidate())if(codeValidate())if(passwordValidate()){var e=document.getElementById("phone").value,n=document.getElementById("password").value,t=document.getElementById("code").value;ajaxSubmit({type:"POST",url:"reg",data:IsPC()?{"user.phone":e,"user.password":n,codeReg:t,inviteuserid:inviteuserid,cr:cr,invitePhone:"null",sourceFrom:1,im:"pc",deviceName:"Web版",deviceType:3}:{"user.phone":e,"user.password":n,codeReg:t,inviteuserid:inviteuserid,cr:cr,invitePhone:"null",sourceFrom:2},success:function(e){"R0001"===e.rcd?console.log(e):IsPC()?"M0008_1"===e.rcd?$("#code-error").html(e.rmg):"M0008_4"===e.rcd&&$("#password-error").html(e.rmg):errorToast(e.rmg)}})}else passwordValidate();else codeValidate();else phoneValidate()}function ajaxSubmit(e){var n=e||{},t=n.type.toUpperCase()||"POST",o=ajaxUrl+n.url||"",r=n.data||null,d=n.complete||function(){},i=n.success||function(){},a=n.error||function(){},c=[];for(var s in r)c.push(s+"="+r[s]);c=c.join("&");var l;l=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),l.onreadystatechange=function(){if(4==l.readyState)if(d(),200==l.status&&l.status<300||304==l.status){var e=JSON.parse(l.responseText);i(e)}else a()},"GET"===t?(l.open(t,c?o+"?"+c:o,!0),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),l.send()):"POST"===t&&(l.open(t,o,!0),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),l.send(c||null))}function friendShowHide(){var e=window.location.href.slice(window.location.href.indexOf("sn=")+3);"-1"!=window.location.href.indexOf("sn=")&&ajaxSubmit({type:"GET",url:"channel/"+e,success:function(e){"R0001"===e.rcd&&(inviteuserid=e.id,cr=e.cookie)}})}function imgHover(e){hoverPic.removeClass("hover").eq(e).addClass("hover")}function alertPicCode(){$("body").css("overflow","hidden"),$(".alert-pic-code").show().css({width:"100%",height:document.documentElement.clientHeight+"px",backgroundColor:"rgba(0,0,0,0.5)"}),imgKey=1e6*Math.random().toFixed(6)+1,$(".input-pic-code").val(""),loadPicCode(imgKey),clickChangePicCode();var e=document.getElementById("phone");$(".submit-pic-code").on("click",function(){sendCode(e)}),$(".close").on("click",function(){$(".alert-pic-code").hide()})}function loadPicCode(e){$.get(ajaxUrl+"CodeOnle?imgKey="+imgKey,{imgKey:e}).done(function(n){$(".pic-code").attr("src",ajaxUrl+"CodeOnle?imgKey="+e)})}function clickChangePicCode(){$(".pic-code").on("click",function(){imgKey=1e6*Math.random().toFixed(6)+1,loadPicCode(imgKey)})}var inviteuserid="",cr="",imgKey="",appLink="https://www.qtz360.com/ch/?sn=",ajaxUrl="https://test.qtz360.com/api/rest/";window.onload=init;var hoverPic=$(".photo-wall img"),number=0;imgHover(number),setInterval(function(){number++,number>hoverPic.length-1&&(number=0),imgHover(number)},1900);