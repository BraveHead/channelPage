function init(){IsPC()?(IsPC(),friendShowHide(),document.getElementById("get-code").addEventListener("click",queryPhone)):-1===window.location.href.indexOf("sn=")&&-1===window.location.href.indexOf("tg=")?window.location.href="https://www.qtz360.com/ch/":-1!==window.location.href.indexOf("tg=")?window.location.href="https://www.qtz360.com/ch/?tg="+window.location.href.slice(window.location.href.indexOf("tg=")+3):window.location.href=appLink+window.location.href.slice(window.location.href.indexOf("sn=")+3)}function IsPC(){for(var e=navigator.userAgent,o=new Array("Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"),n=!0,t=0;t<o.length;t++)if(e.indexOf(o[t])>0){n=!1;break}return n}function phoneValidate(){return/^1[3456789]\d{9}$/.test(document.getElementById("phone").value)?(IsPC()&&(document.getElementById("phone-error").innerHTML=""),!0):IsPC()?(document.getElementById("phone-error").innerHTML="*请输入正确的手机号码",!1):(errorToast("*请输入正确的手机号码"),!1)}function codeValidate(){return/^[0-9]{6}$/.test(document.getElementById("code").value)?(IsPC()&&(document.getElementById("code-error").innerHTML=""),!0):IsPC()?(document.getElementById("code-error").innerHTML="*请输入正确的验证码",!1):(errorToast("*请输入正确的验证码"),!1)}function passwordValidate(){var e=document.getElementById("password").value;return new RegExp(/^[0-9A-Za-z]+$/).test(e)&&new RegExp(/[A-Za-z].*[0-9]|[0-9].*[A-Za-z]/).test(e)?(IsPC()&&(document.getElementById("password-error").innerHTML=""),!0):(IsPC()?document.getElementById("password-error").innerHTML="*请输入8至20位数字和字母组合":errorToast("*请输入8至20位数字和字母组合"),!1)}function errorToast(e){var o='<div class="error-toast" id="error-toast"><span>'+e+"</span></div>";document.getElementById("error-toast")?(document.body.removeChild(document.getElementById("error-toast")),document.body.insertAdjacentHTML("afterBegin",o)):(document.body.insertAdjacentHTML("afterBegin",o),setTimeout(function(){document.body.removeChild(document.getElementById("error-toast"))},1e3))}function setPhoneCode(e){switch(e.value=e.value.replace(/[^\d]/g,""),e.id){case"phone":e.value.length>11&&(e.value=e.value.slice(0,11)),clearHideShowImg(e);break;case"code":e.value.length>6&&(e.value=e.value.slice(0,6))}}function clearHideShowImg(e){switch(e.id){case"phone":""!=e.value?document.getElementById("clear-phone").style.display="block":document.getElementById("clear-phone").style.display="none";break;case"password":""!=e.value?(document.getElementById("clear-password").style.display="block",document.getElementById("hide-show").style.display="block"):(document.getElementById("clear-password").style.display="none",document.getElementById("hide-show").style.display="none")}}function clearInputValue(e){switch(e.id){case"clear-phone":document.getElementById("phone").value="",clearHideShowImg(document.getElementById("phone"));break;case"clear-password":document.getElementById("password").value="",clearHideShowImg(document.getElementById("password"))}}function passwordToggleHideShow(e){var o=document.getElementById("password");switch(o.type){case"password":o.type="text",e.src="assets/show.png";break;case"text":o.type="password",e.src="assets/hide.png"}}function queryPhone(){var e=document.getElementById("phone"),o=document.getElementById("phone-error");/^1[3456789]\d{9}$/.test(e.value)?ajaxSubmit({type:"GET",url:"isPhoneUsed",data:{phoneReg:document.getElementById("phone").value,invitePhone:"null"},success:function(e){return"A0001"===e.rcd?IsPC()?(o.innerHTML=e.rmg,!1):(errorToast(e.rmg),!1):"A0002"===e.rcd?(IsPC()&&(o.innerHTML=""),alertPicCode(),!0):IsPC()?(o.innerHTML=e.rmg,!1):(errorToast(e.rmg),!1)}}):phoneValidate()}function sendCode(e){function o(e){var o=e<10?"0"+e:e;e>0?t.innerHTML=o+"s":(clearInterval(n),t.innerHTML="重新获取")}var n,t=document.getElementById("get-code"),r=document.getElementById("code-error"),i=60;ajaxSubmit({type:"POST",url:"sendPCode",data:{phoneReg:e.value,imgKey:imgKey,imgCode:$(".input-pic-code").val(),source:"pc"},success:function(e){"R0001"===e.rcd?IsPC()?(r.innerHTML=e.rmg,o(i),n=setInterval(function(){i--,o(i)},1e3),$(".alert-pic-code").hide()):errorToast(e.rmg):IsPC()?$(".pic-code-error").html(e.rmg):errorToast(e.rmg)}})}function formSubmit(){if(phoneValidate())if(codeValidate())if(passwordValidate()){var e=document.getElementById("phone").value,o=document.getElementById("password").value,n=document.getElementById("code").value,t="",r="";-1!==window.location.href.indexOf("tg=")?(t="user.organization",r=window.location.href.slice(window.location.href.indexOf("tg=")+3)):(t="user.organization",r="");var i={"user.phone":e,"user.password":o,codeReg:n,inviteuserid:inviteuserid,cr:cr,invitePhone:"null",sourceFrom:1,im:"pc",deviceName:"Web版",deviceType:3};i[t]=r,ajaxSubmit({type:"POST",url:"reg",data:IsPC()?i:{"user.phone":e,"user.password":o,codeReg:n,inviteuserid:inviteuserid,cr:cr,invitePhone:"null",sourceFrom:2,im:"pc",deviceName:"Web版",deviceType:3},success:function(e){"R0001"===e.rcd?window.location.href="https://www.qtz360.com/user/login.do":IsPC()?"M0008_1"===e.rcd?$("#code-error").html(e.rmg):"M0008_4"===e.rcd&&$("#password-error").html(e.rmg):errorToast(e.rmg)}})}else passwordValidate();else codeValidate();else phoneValidate()}function ajaxSubmit(e){var o=e||{},n=o.type.toUpperCase()||"POST",t=ajaxUrl+o.url||"",r=o.data||null,i=o.complete||function(){},d=o.success||function(){},c=o.error||function(){},a=[];for(var s in r)a.push(s+"="+r[s]);a=a.join("&");var l;l=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),l.onreadystatechange=function(){if(4==l.readyState)if(i(),200==l.status&&l.status<300||304==l.status){var e=JSON.parse(l.responseText);d(e)}else c()},"GET"===n?(l.open(n,a?t+"?"+a:t,!0),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),l.send()):"POST"===n&&(l.open(n,t,!0),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),l.send(a||null))}function friendShowHide(){var e=window.location.href.slice(window.location.href.indexOf("sn=")+3);"-1"!=window.location.href.indexOf("sn=")&&ajaxSubmit({type:"GET",url:"channel/"+e,success:function(e){"R0001"===e.rcd&&(inviteuserid=e.id,cr=e.cookie)}})}function imgHover(e){hoverPic.removeClass("hover").eq(e).addClass("hover")}function alertPicCode(){$("body").css("overflow","hidden"),$(".alert-pic-code").show().css({width:"100%",height:document.documentElement.clientHeight+"px",backgroundColor:"rgba(0,0,0,0.5)"}),imgKey=1e6*Math.random().toFixed(6)+1,$(".input-pic-code").val(""),loadPicCode(imgKey),clickChangePicCode();var e=document.getElementById("phone");$(".submit-pic-code").on("click",function(){sendCode(e),$("body").css("overflow","scroll")}),$(".close").on("click",function(){$(".alert-pic-code").hide(),$("body").css("overflow","scroll")})}function loadPicCode(e){$.get(ajaxUrl+"CodeOnle?imgKey="+imgKey,{imgKey:e}).done(function(o){$(".pic-code").attr("src",ajaxUrl+"CodeOnle?imgKey="+e)})}function clickChangePicCode(){$(".pic-code").on("click",function(){imgKey=1e6*Math.random().toFixed(6)+1,loadPicCode(imgKey)})}var inviteuserid="",cr="",imgKey="",appLink="https://www.qtz360.com/ch/?sn=",ajaxUrl=window.commonRequestPrefix;window.onload=init;var hoverPic=$(".photo-wall img"),number=0;imgHover(number),setInterval(function(){number++,number>hoverPic.length-1&&(number=0),imgHover(number)},1900);